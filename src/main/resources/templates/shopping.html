<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8"/>
    <title>Title</title>
    <script src="/js/jquery-2.1.1.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/css.css">
    <link rel="stylesheet" href="/js/easyui1.5/themes/icon.css">
    <link rel="stylesheet" href="/js/easyui1.5/themes/default/easyui.css">
    <script src="/js/easyui1.5/jquery.easyui.min.js"></script>



</head>
<script type="text/javascript" th:inline="none">
    $(function () {
        getUserName();
       initDategrid(); //初始化数据表格控件
        setEvent();
    })
    /* 表头 你好登录样式======================================>  start*/
    function getUserName() {
        var hiddenName = $("#hiddenName").val();
        console.log("作用域中的名字=======" + hiddenName);
        if (hiddenName != "" & hiddenName != null) {
            /*start*/
            var hiddenName = $("#hiddenName").val();
            if (hiddenName != null & hiddenName!="") {
                console.log(hiddenName);
                console.log("用户名为"+hiddenName);
                $("#username1").html("你好  ,<font color='red'>" + hiddenName+"</font>");
            }
            /*end*/
        } else {
            if (document.cookie != "" & document.cookie != null) {
                var cookie=document.cookie;
                console.log("-=====>"+cookie)
                var sp=cookie.split("=");
                var userName=sp[2];
                $("#hidden1").val(userName);
            }
            $("#username1").html("你好,  <font color='red'> " + userName + " </font>   ,请登录");
        }
    }
    /* 表头 你好登录 ======================================>   end*/

    //------------------------------------------------------查询开始
    function initDategrid(){

        var hiddenName=$("#hiddenName").val();
        var hiddenName1=$("#hiddenName1").val();
        console.log(hiddenName1)
        console.log(hiddenName)
        if(hiddenName==""  &&  hiddenName1==""){
            /*展示  session中   没有值   start*/
            $('#dg').datagrid({
                url:'/shopping/getShopingTemp',
                striped:true,
                toolbar: '#tb',
                pagination:true,
                pagePosition:top,
                pageList:[1,2,3,4,5,6,8,10],
                pageSize: 5, //默认显示多少条 这个值一定在pagelist中存在
                loadMsg:'正在加载,别着急',
                columns:[[
                    {field:'xxx',title:'ID',width:'5%',checkbox:true},
                    {field:'id',title:'ID',width:'5%'},
                    {field:'mch',title:'商品名称',width:350,editor:'text'},
                    {field:'tjshl',title:'商品数量',width:100,align:'right'} ,
                    {field:'jg',title:'商品价格',width:100,align:'right'} ,
                    /* {field:'sku_mch',title:'商品属性',width:300,editor:'text'},*/
                    {field:'shptp',title:'商品图片',width:150,align:'right',
                        formatter: function(value,row,index){
                            return "<img width='66' src='"+value+"'>";
                        }} ,
                    {field:'操作',title:'操作',width:100,align:'right',
                        formatter: function(value,row,index){
                            var content=""
                            content+= "<a href='javascript:void(0)' onclick=deleteItemById("+row.id+",'"+row.mch+"')> 删除</a>"
                            return content;
                        }
                    },
                ]],
                checkOnSelect:false,//-------如果为true，当用户点击行的时候该复选框就会被选中或取消选中。
                                    // 如果为false，当用户仅在点击该复选框的时候才会呗选中或取消。
            });
            /*展示  session中    没有值   end*/
        }else{
            /*展示  session中有值   start*/
            $('#dg').datagrid({
                url:'/js/getgoulist',
                striped:true,
                toolbar: '#tb',
                pagination:true,
                pagePosition:top,
                pageList:[1,2,3,4,5,6,8,10],
                pageSize: 5, //默认显示多少条 这个值一定在pagelist中存在
                loadMsg:'正在加载,别着急',
                columns:[[
                    {field:'xxx',title:'ID',width:'5%',checkbox:true},
                    {field:'id',title:'ID',width:'5%'},
                    {field:'mch',title:'商品名称',width:350,editor:'text'},
                    {field:'tjshl',title:'商品数量',width:100,align:'right'} ,
                    {field:'jg',title:'商品价格',width:100,align:'right'} ,
                   /* {field:'sku_mch',title:'商品属性',width:300,editor:'text'},*/
                    {field:'shptp',title:'商品图片',width:150,align:'right',
                        formatter: function(value,row,index){
                            return "<img width='66' src='"+value+"'>";
                        }} ,
                    {field:'操作',title:'操作',width:100,align:'right',
                        formatter: function(value,row,index){
                            var content=""
                            content+= "<a href='javascript:void(0)' onclick=deleteItemById("+row.id+",'"+row.mch+"')> 删除</a>"
                            return content;
                        }
                    },
                ]],
                checkOnSelect:false,//-------如果为true，当用户点击行的时候该复选框就会被选中或取消选中。
                                    // 如果为false，当用户仅在点击该复选框的时候才会呗选中或取消。

            });
            /*展示  session中有值   end*/
        }


    }
    //-------------------------------------------------------查询结束

    //------------------------------------------------------删除开始
    function deleteItemById(id,name){
        $.messager.confirm('删除提示框','您确认想要删除'+name+'这件商品吗？',function(r){
            if (r){    //点击确认
                deleteItem(id);
            }
        });
    }
    //批删,单删
    function deleteItem(ids){
        alert(ids);
        $.ajax({
            url:"/js/deleteItem",
            type:"POST",
            data:{ids:ids},
            success:function(result){
                //数据库已经删除成功 页面需要更新
                $("#dg").datagrid('reload');//reload 会重新请求数据 但会停留在当前页
                //load 会跑到第一页
                $.messager.show({
                    title:'消息',
                    msg:'删除成功!!',
                    timeout:5000,
                    showType:'slide'
                });
            },
            error:function(){
                alert("ajax访问失败了,查看控制台");
            }
        });
    }


    //-------------------------------------------------计算总价开始
    function setEvent(){
        $("#btn_dele").linkbutton({
            onClick:function(){
                var rows = $("#dg").datagrid('getChecked');
                //判断有没有选中数据
                            var ids =0;
                            $.each(rows,function(index,obj){
                           ids+=obj.jg*obj.tjshl;
                            });
                            $("#sss").html(ids);
            }
        });

    }
    //---------------------------------------------------计算总价结束

    function removeUser() {
        /*ajax   start*/
        $.ajax({
            url:"/login/removeUser",
            type:"POST",
            data:$("form").serialize(),
            success:function(a){
                location.reload();
            },
            error:function(){
                layer.msg("ajax失败");
            }
        });
        /*ajax   end*/
    }

    function toLogin() {
        var htmlUrl=document.documentURI
        /*ajax   start*/
        $.ajax({
            url:"/phoneLogin/toBackHtml",
            type:"POST",
            data:{requestUrl:htmlUrl},
            beforeSend:function(){
                ii = layer.msg('加载中', {
                    icon: 16
                    ,shade: 0.01
                });
            },
            success:function(a){
                window.location.href="/login/toLoginHtml";
            },
            error:function(){
                layer.msg("ajax失败");
            },complete:function(){
                layer.close(ii);
            }
        });
        /*ajax   end*/
    }
</script>
<body style="zoom: 1;">
<input type="hidden" id="skuid1" th:value="${param?.skuid}">
<input id="hiddenName" type="hidden" th:value="${session.userf?.username}">
<input id="hiddenName1" type="hidden" th:value="${session.userf?.id}">
<input id="hidden1" type="hidden">
<div class="top">
    <div class="top_text">
        <a href='javascript:void(0)' onclick=removeUser()>注销</a>
        <a href='javascript:void(0)' onclick=toLogin()>用户登录</a>
        <a href="">用户注册</a>
        <a href="">供应商登录</a>
        <a href="">供应商注册</a>
        <div id="username1"></div>
    </div>
</div>
<div class="top_img">
    <img src="./images/top_img.jpg" alt="">
</div>
<div class="search">
    <div class="logo"><img src="/images/logo.jpg" alt=""></div>
    <div class="search_on">
        <div class="se">
            <input type="text" name="search" class="lf">
            <input type="submit" class="clik" value="搜索" style="height: 32px;">
        </div>
        <div class="se">
            <a href="">取暖神奇</a>
            <a href="">1元秒杀</a>
            <a href="">吹风机</a>
            <a href="">玉兰油</a>
        </div>
    </div>
</div>

<div class="Cbox">
  <!--  <table class="table table-striped table-bordered table-hover">-->
    <a id="btn_dele"  href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-remove'">总价</a>
    <table id="dg" style="height:380px;width:1200px"></table>
  <!--  </table>-->
</div>
<div class="Cprice">
    <div class="price">总价：<span id="sss"></span></div>
    <div class="jiesuan">结算</div>
</div>
<div class="footer">
    <div class="top"></div>
    <div class="bottom"><img src="/images/foot.jpg" alt=""></div>
</div>

<!-- 模态弹出窗内容 -->
<input type="hidden" id="yh_id" th:value="${param?.yh_id}">
</body>
</html>